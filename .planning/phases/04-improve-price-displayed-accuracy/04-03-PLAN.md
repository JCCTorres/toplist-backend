---
phase: 04-improve-price-displayed-accuracy
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx
autonomous: true

must_haves:
  truths:
    - "Property cards display 'From $X/night + fees' pricing"
    - "Price is derived from property's rates data when available"
    - "Fallback to 'Contact for pricing' if no rate data"
    - "'+fees' indicator sets expectation that cleaning fee and taxes apply"
  artifacts:
    - path: "Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx"
      provides: "Property card with price display"
      contains: "From $"
  key_links:
    - from: "Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx"
      to: "property.rates"
      via: "rate extraction logic"
      pattern: "rates.*nightly_rate"
---

<objective>
Add price display to PropertyCard component.

Purpose: Show users estimated nightly rates on property cards so they can compare prices before viewing details.
Output: Updated PropertyCard.jsx with "From $X/night + fees" pricing display.
</objective>

<execution_context>
@C:\Users\joao_\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\joao_\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-improve-price-displayed-accuracy/04-RESEARCH.md
@.planning/phases/04-improve-price-displayed-accuracy/04-01-SUMMARY.md
@Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add price display to PropertyCard</name>
  <files>Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx</files>
  <action>
Modify PropertyCard.jsx to display pricing:

1. Add a helper function inside the component (after line 11, before the return):
   ```jsx
   // Get display price from property rates
   const getDisplayPrice = () => {
     // Check if rates array exists
     if (Array.isArray(property.rates) && property.rates.length > 0) {
       // Find first rate with nightly_rate > 0
       const activeRate = property.rates.find(r => r.nightly_rate > 0);
       if (activeRate) {
         return `$${Math.round(activeRate.nightly_rate)}`;
       }
       // Fallback to weekend rate
       const weekendRate = property.rates.find(r => r.weekend_rate > 0);
       if (weekendRate) {
         return `$${Math.round(weekendRate.weekend_rate)}`;
       }
     }

     // Check for price field directly on property (from search results)
     if (property.price && property.price > 0) {
       return `$${Math.round(property.price)}`;
     }

     // Check for booking_price (from multi-property search)
     if (property.booking_price && property.booking_price > 0) {
       return `$${Math.round(property.booking_price)}`;
     }

     return null;
   };

   const displayPrice = getDisplayPrice();
   ```

2. Add price display in the card content, after the city section and before the View Details button.
   Find the `<div className="mt-auto">` section (around line 65) and add the price display just before it:

   ```jsx
   {/* Price display */}
   {displayPrice ? (
     <div className="flex items-center justify-between mb-4">
       <div className="flex items-baseline gap-1">
         <span className="text-lg font-semibold text-gold-400">{displayPrice}</span>
         <span className="text-sand-200/60 text-sm">/night</span>
       </div>
       <span className="text-xs text-sand-200/40">+ fees</span>
     </div>
   ) : (
     <div className="text-sand-200/50 text-sm mb-4">
       Contact for pricing
     </div>
   )}
   ```

The price will appear between the location and the "View Details" button, using gold accent color to draw attention.
  </action>
  <verify>
1. Check the file has getDisplayPrice: `grep -n "getDisplayPrice" "Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx"`
2. Check price display markup: `grep -n "displayPrice" "Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx"`
3. Check for fees indicator: `grep -n "+ fees" "Toplist Final/toplist-main/toplist-main/src/features/home/components/PropertiesSection/PropertyCard.jsx"`
  </verify>
  <done>PropertyCard.jsx displays "From $X/night + fees" with gold accent, or "Contact for pricing" fallback</done>
</task>

<task type="auto">
  <name>Task 2: Verify home page card data includes rates</name>
  <files>Toplist Final/toplist-main/toplist-main/src/pages/Properties.jsx</files>
  <action>
Check that the Properties page passes the full property object to PropertyCard.

Read the Properties.jsx file and verify:
1. Properties are fetched using api.getProperties() or similar
2. The full property object (including rates) is passed to PropertyCard
3. If rates are not being passed, update the data flow

The home-cards endpoint returns limited data. For the Properties listing page, if rates aren't included, we need to ensure they are. Check if the /api/bookerville/home-cards endpoint returns rates data.

If the endpoint doesn't return rates, this is expected - the home page cards show "Contact for pricing" which is acceptable. The search results from multi-property search include booking_price which PropertyCard now handles.

Document findings:
- Home page cards: May not have rates (show fallback)
- Search results: Have booking_price from Bookerville search
- Property details page: Has full rates array

No code changes needed if the data flow is already correct. Just verify the PropertyCard handles all three scenarios.
  </action>
  <verify>
Test by running the dev server and checking:
1. Home page cards show price if available, or "Contact for pricing"
2. Search results show price from booking_price
3. No JavaScript errors in console
  </verify>
  <done>PropertyCard correctly displays pricing from rates, price, or booking_price fields; shows fallback when none available</done>
</task>

</tasks>

<verification>
1. PropertyCard.jsx contains getDisplayPrice function
2. Cards display "$X/night + fees" or "Contact for pricing"
3. No console errors when viewing Properties page
4. Price styling matches dark theme (gold accent)
</verification>

<success_criteria>
- Property cards show "From $X/night + fees" when rate data available
- Cards show "Contact for pricing" when no rate data
- Gold accent color (#F5A623 / gold-400) used for price
- "+ fees" indicator visible in smaller text
- No breaking changes to existing card layout
</success_criteria>

<output>
After completion, create `.planning/phases/04-improve-price-displayed-accuracy/04-03-SUMMARY.md`
</output>
