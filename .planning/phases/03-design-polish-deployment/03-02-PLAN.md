---
phase: 03-design-polish-deployment
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - Toplist Final/toplist-main/toplist-main/vite.config.js
  - Toplist Final/toplist-main/toplist-main/.gitignore
  - .planning/phases/03-design-polish-deployment/DEPLOYMENT-GUIDE.md
autonomous: false
user_setup:
  - service: cloudways
    why: "Managed hosting for Laravel + React application"
    account_setup:
      - task: "Create Cloudways account"
        url: "https://www.cloudways.com"
    env_vars:
      - name: APP_KEY
        source: "Auto-generated by Laravel on server"
      - name: APP_URL
        source: "Your domain (e.g., https://yourdomain.com)"
      - name: BOOKERVILLE_API_KEY
        source: "Keep from existing .env - Bookerville dashboard"
      - name: BOOKERVILLE_ACCOUNT_ID
        source: "Keep from existing .env - Bookerville dashboard"
      - name: MAIL_HOST
        source: "SMTP provider (e.g., smtp.gmail.com)"
      - name: MAIL_USERNAME
        source: "SMTP username/email"
      - name: MAIL_PASSWORD
        source: "SMTP password or app password"
    dashboard_config:
      - task: "Point domain to Cloudways IP"
        location: "Your domain registrar DNS settings"

must_haves:
  truths:
    - "Production build runs with npm run build and outputs to dist/"
    - "Environment variables are NOT committed to git"
    - "Deployment guide is clear and step-by-step for non-technical user"
    - "Same-origin serving is configured (Laravel serves React build)"
  artifacts:
    - path: "Toplist Final/toplist-main/toplist-main/vite.config.js"
      provides: "Production build configuration"
      contains: "base.*'/'.*sourcemap.*false"
    - path: ".planning/phases/03-design-polish-deployment/DEPLOYMENT-GUIDE.md"
      provides: "Step-by-step deployment instructions"
      min_lines: 100
    - path: "Toplist Final/toplist-main/toplist-main/.gitignore"
      provides: "Ensures sensitive files not committed"
      contains: ".env"
  key_links:
    - from: "vite.config.js"
      to: "Laravel public directory"
      via: "build output configuration"
      pattern: "outDir.*dist"
---

<objective>
Configure production build and create comprehensive deployment guide for non-technical user to deploy Laravel backend + React frontend to Cloudways.

Purpose: Enable project owner to deploy and manage the production site independently
Output: Production-ready build configuration and detailed deployment guide
</objective>

<execution_context>
@C:\Users\joao_\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\joao_\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-design-polish-deployment/03-RESEARCH.md
@.planning/phases/03-design-polish-deployment/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure production build</name>
  <files>
    Toplist Final/toplist-main/toplist-main/vite.config.js
    Toplist Final/toplist-main/toplist-main/.gitignore
  </files>
  <action>
    1. Update vite.config.js for production:
       ```javascript
       export default defineConfig({
         plugins: [react()],
         base: '/',  // Root path for same-origin serving
         resolve: {
           alias: {
             '@': path.resolve(__dirname, './src'),
           },
         },
         server: {
           open: true,
           port: 3001
         },
         build: {
           outDir: 'dist',
           emptyOutDir: true,
           sourcemap: false,  // Disable in production for security
           rollupOptions: {
             output: {
               manualChunks: undefined,
             },
           },
         },
         css: {
           postcss: './postcss.config.js',
         },
       });
       ```

    2. Verify .gitignore includes security-critical entries:
       - .env
       - .env.local
       - .env.production
       - .env.*.local
       - dist/
       - node_modules/

       If any are missing, add them.

    3. Test production build:
       - Run `npm run build`
       - Verify dist/ folder is created with index.html, assets/

    NOTE: The React build will later be copied to Laravel's public directory for same-origin serving.
  </action>
  <verify>
    Run these commands and check output:
    ```bash
    cd "Toplist Final/toplist-main/toplist-main"
    npm run build
    ls dist/
    ```
    Should see: index.html, assets/ folder with JS/CSS bundles

    Verify .gitignore:
    ```bash
    grep ".env" .gitignore
    ```
    Should show .env entries
  </verify>
  <done>
    Production build configured with base '/', sourcemaps disabled, outputs to dist/. Sensitive files confirmed in .gitignore.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive deployment guide</name>
  <files>
    .planning/phases/03-design-polish-deployment/DEPLOYMENT-GUIDE.md
  </files>
  <action>
    Create a detailed, beginner-friendly deployment guide with these sections:

    # Toplist Orlando Deployment Guide

    ## Overview
    - What we're deploying (Laravel + React)
    - Same-origin architecture explanation (simple)
    - Estimated time: 30-45 minutes

    ## Prerequisites
    - [ ] Domain name ready
    - [ ] Cloudways account (link to signup)
    - [ ] This codebase downloaded
    - [ ] Current .env values saved somewhere safe

    ## Step 1: Create Cloudways Account & Server
    - Screenshots-friendly instructions
    - Choose DigitalOcean/Vultr (cheapest)
    - Select PHP 8.1+ stack
    - Choose location near Florida

    ## Step 2: Create Laravel Application
    - In Cloudways dashboard
    - PHP 8.1+ application
    - Note down database credentials

    ## Step 3: Upload Code to Server
    - Using Cloudways SFTP or Git
    - Simple step-by-step

    ## Step 4: Configure Environment Variables
    - Where to find the settings
    - List of ALL required variables with explanations:
      * APP_KEY (how to generate)
      * APP_ENV=production
      * APP_DEBUG=false
      * APP_URL
      * DB_* (from Cloudways)
      * BOOKERVILLE_API_KEY (from existing .env)
      * BOOKERVILLE_ACCOUNT_ID (from existing .env)
      * MAIL_* settings
    - SECURITY: Never share these values

    ## Step 5: Build and Deploy React Frontend
    - Run npm run build locally
    - Copy dist/ contents to Laravel public/
    - Or use Cloudways build if Node available

    ## Step 6: Configure Laravel to Serve React
    - Add catch-all route in routes/web.php:
      ```php
      Route::get('/{any}', function () {
          return file_get_contents(public_path('index.html'));
      })->where('any', '(?!api).*');
      ```

    ## Step 7: Point Domain
    - Add domain in Cloudways
    - Update DNS at registrar
    - Enable SSL (free via Cloudways)

    ## Step 8: Verify Deployment
    - Checklist of what to test
    - Common issues and fixes

    ## Troubleshooting
    - "Page not found" → route config
    - "API errors" → CORS or env vars
    - "Styles missing" → build process
    - "Images not loading" → asset paths

    ## Security Reminders
    - Never commit .env
    - APP_DEBUG=false in production
    - Keep Bookerville credentials secure
    - Regular backups via Cloudways

    ## Maintenance
    - How to update the site
    - Rebuilding React after changes
    - Checking logs

    Write in simple, non-technical language. Assume reader has never deployed a website before.
  </action>
  <verify>
    Read through the guide and check:
    - [ ] Every step has clear action items
    - [ ] No assumed technical knowledge
    - [ ] All environment variables documented
    - [ ] Security warnings are prominent
    - [ ] Troubleshooting covers common issues
  </verify>
  <done>
    Comprehensive deployment guide created at DEPLOYMENT-GUIDE.md covering Cloudways setup, environment configuration, build process, and troubleshooting. Written for non-technical users.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Production deployment preparation:
    - Vite configured for production builds (base '/', no sourcemaps)
    - .gitignore verified for security (no .env files committed)
    - Comprehensive deployment guide for Cloudways
    - All environment variables documented
    - Same-origin serving instructions included
  </what-built>
  <how-to-verify>
    1. BUILD TEST:
       ```bash
       cd "Toplist Final/toplist-main/toplist-main"
       npm run build
       ```
       - [ ] Build completes without errors
       - [ ] dist/ folder contains index.html
       - [ ] dist/assets/ contains JS and CSS bundles

    2. SECURITY CHECK:
       - [ ] Open .gitignore - confirm .env is listed
       - [ ] Confirm NO .env file is committed to git

    3. GUIDE REVIEW:
       - [ ] Open DEPLOYMENT-GUIDE.md
       - [ ] Read through all steps
       - [ ] Confirm it's understandable for non-technical person
       - [ ] All environment variables are documented
       - [ ] Security warnings are clear

    4. READY TO DEPLOY?
       - [ ] Do you have a domain name ready?
       - [ ] Do you have access to Bookerville API credentials?
       - [ ] Are you ready to create a Cloudways account?
  </how-to-verify>
  <resume-signal>
    Type "approved" if ready to proceed with deployment using the guide, or describe concerns/questions about the deployment process.
  </resume-signal>
</task>

</tasks>

<verification>
- `npm run build` completes successfully
- dist/ folder contains production assets
- .gitignore prevents .env from being committed
- DEPLOYMENT-GUIDE.md is comprehensive and beginner-friendly
- All required environment variables are documented
- Same-origin serving instructions are clear
</verification>

<success_criteria>
1. Production build works and outputs optimized assets
2. Source maps disabled for security
3. Deployment guide covers every step from account creation to verification
4. Guide is written for non-technical users
5. All sensitive credentials are documented (what they are, where to get them)
6. Security best practices are explained
7. Troubleshooting section covers common issues
</success_criteria>

<output>
After completion, create `.planning/phases/03-design-polish-deployment/03-02-SUMMARY.md`
</output>
