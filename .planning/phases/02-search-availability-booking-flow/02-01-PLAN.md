---
phase: 02-search-availability-booking-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/api.js
  - src/features/home/hooks/useSearchFilters.js
  - src/pages/Properties.jsx
autonomous: true

must_haves:
  truths:
    - "User can enter check-in and check-out dates in search bar"
    - "User can specify number of guests in search bar"
    - "Submitting search navigates to properties page with filtered results"
    - "Properties page shows only available properties for selected dates"
    - "Empty results display friendly 'no properties available' message"
  artifacts:
    - path: "src/services/api.js"
      provides: "searchProperties API method"
      contains: "searchProperties"
    - path: "src/features/home/hooks/useSearchFilters.js"
      provides: "API-connected search with navigation"
      contains: "navigate"
    - path: "src/pages/Properties.jsx"
      provides: "Search-aware properties listing"
      contains: "useSearchParams"
  key_links:
    - from: "src/features/home/hooks/useSearchFilters.js"
      to: "/homes?checkin=...&checkout=...&adults=..."
      via: "useNavigate with URLSearchParams"
      pattern: "navigate.*homes"
    - from: "src/pages/Properties.jsx"
      to: "api.searchProperties"
      via: "conditional fetch based on URL params"
      pattern: "searchProperties.*startDate.*endDate"
---

<objective>
Wire search bar to API and display filtered available properties.

Purpose: Enable guests to search by dates and guests, seeing only available properties.
Output: Working search-to-results flow from HeroSection to Properties page.
</objective>

<execution_context>
@C:\Users\joao_\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\joao_\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-search-availability-booking-flow/02-RESEARCH.md

# Phase 1 established patterns
@.planning/phases/01-api-connection-data-wiring/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add searchProperties API method</name>
  <files>src/services/api.js</files>
  <action>
Add searchProperties method to api object in src/services/api.js.

Implementation:
```javascript
/**
 * Search properties by availability, dates, and guests
 * @param {Object} params - { startDate, endDate, numAdults, numChildren }
 * @returns {Promise<{success: boolean, data: {results: Array, total_results: number}}>}
 */
searchProperties: async (params) => {
  const response = await fetch(`${BASE_URL}/properties/search`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      startDate: params.startDate,
      endDate: params.endDate,
      numAdults: parseInt(params.numAdults) || 1,
      numChildren: parseInt(params.numChildren) || 0
    })
  });
  return handleResponse(response);
},
```

Insert this method after getPropertyAvailability in the api object.
  </action>
  <verify>Run `grep -n "searchProperties" src/services/api.js` - should show the new method</verify>
  <done>searchProperties method exists in api.js with POST to /properties/search</done>
</task>

<task type="auto">
  <name>Task 2: Wire useSearchFilters to API and navigation</name>
  <files>src/features/home/hooks/useSearchFilters.js</files>
  <action>
Update useSearchFilters.js to navigate to Properties page with search params instead of console.log/alert.

Changes:
1. Add import: `import { useNavigate } from 'react-router-dom';`
2. Add navigate hook inside useSearchFilters: `const navigate = useNavigate();`
3. Add date formatting helper:
   ```javascript
   const formatDate = (date) => date.toISOString().split('T')[0]; // 'YYYY-MM-DD'
   ```
4. Replace handleSearch implementation:
   ```javascript
   const handleSearch = () => {
     if (dates.length !== 2) {
       alert('Please select check-in and check-out dates');
       return;
     }

     // Navigate to properties page with search params
     const params = new URLSearchParams({
       checkin: formatDate(dates[0]),
       checkout: formatDate(dates[1]),
       adults: guests || '1',
       children: houseName || '0'  // houseName is actually children count
     });

     navigate(`/homes?${params.toString()}`);
   };
   ```

Remove the console.log and alert('Search functionality...') - replace with real navigation.
  </action>
  <verify>Run `grep -n "navigate" src/features/home/hooks/useSearchFilters.js` - should show import and usage</verify>
  <done>handleSearch navigates to /homes with checkin, checkout, adults, children URL params</done>
</task>

<task type="auto">
  <name>Task 3: Update Properties page to handle search params</name>
  <files>src/pages/Properties.jsx</files>
  <action>
Modify Properties.jsx to:
1. Read URL search params and conditionally call searchProperties API
2. Display search context when filtering
3. Show friendly empty state when no results

Changes:
1. Add import: `import { useSearchParams, Link } from 'react-router-dom';`
2. Replace the existing Link import if needed
3. Add api import if not present (should already be there)

4. Inside Properties function, add URL param reading:
   ```javascript
   const [searchParams] = useSearchParams();
   const checkin = searchParams.get('checkin');
   const checkout = searchParams.get('checkout');
   const adults = searchParams.get('adults');
   const children = searchParams.get('children');

   const hasSearchParams = checkin && checkout;
   ```

5. Update useApi call to conditionally fetch:
   ```javascript
   const { data, loading, error, refetch } = useApi(
     () => hasSearchParams
       ? api.searchProperties({ startDate: checkin, endDate: checkout, numAdults: adults, numChildren: children })
       : api.getProperties(),
     [checkin, checkout, adults, children]
   );
   ```

6. Update properties extraction:
   ```javascript
   const properties = hasSearchParams
     ? data?.data?.results || []
     : data?.data?.properties || [];
   ```

7. Update header section to show search context:
   ```jsx
   <h1 className="text-4xl font-bold text-center text-gray-800 mb-4">
     {hasSearchParams ? 'Available Properties' : 'All Properties'}
   </h1>
   <p className="text-lg text-gray-600 text-center max-w-2xl mx-auto">
     {hasSearchParams
       ? `Showing properties available from ${checkin} to ${checkout} for ${adults} adult${adults !== '1' ? 's' : ''}${children && children !== '0' ? ` and ${children} child${children !== '1' ? 'ren' : ''}` : ''}.`
       : 'Discover our complete collection of premium vacation rental properties in Orlando\'s most sought-after resorts.'
     }
   </p>
   {hasSearchParams && (
     <div className="text-center mt-4">
       <Link to="/homes" className="text-pink-500 hover:text-pink-600 underline">
         Clear search and show all properties
       </Link>
     </div>
   )}
   ```

8. Add empty state after properties grid section (inside the container):
   ```jsx
   {properties.length === 0 && !loading && !error && (
     <div className="text-center py-12">
       <div className="bg-gray-50 rounded-lg p-8 max-w-lg mx-auto">
         <svg className="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
           <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
         <h3 className="text-xl font-semibold text-gray-700 mb-2">No Properties Available</h3>
         <p className="text-gray-600 mb-4">
           {hasSearchParams
             ? 'No properties are available for your selected dates. Try different dates or contact us for assistance.'
             : 'No properties found. Please check back later.'
           }
         </p>
         <Link to="/contact" className="text-pink-500 hover:text-pink-600 underline">
           Contact us for help
         </Link>
       </div>
     </div>
   )}
   ```
  </action>
  <verify>
1. Run `grep -n "useSearchParams" src/pages/Properties.jsx` - should show import and usage
2. Run `grep -n "searchProperties" src/pages/Properties.jsx` - should show conditional API call
3. Run `grep -n "Available Properties" src/pages/Properties.jsx` - should show dynamic header
  </verify>
  <done>Properties page reads URL params, calls searchProperties when present, shows filtered results with context message and empty state</done>
</task>

</tasks>

<verification>
After all tasks:
1. Start dev server: `npm run dev`
2. Go to home page, enter dates and guest count in search bar
3. Click Search - should navigate to /homes?checkin=...&checkout=...&adults=...
4. Properties page should show "Available Properties" header with date range
5. Grid should show filtered results from searchProperties API
6. "Clear search" link should return to /homes (all properties)
7. Test with dates that have no availability - should show empty state
</verification>

<success_criteria>
- Search bar dates and guests submit via URL params to /homes
- Properties page detects URL params and calls searchProperties API
- Filtered results display with search context message
- Empty state shows friendly message with contact link
- "Clear search" link returns to full property listing
</success_criteria>

<output>
After completion, create `.planning/phases/02-search-availability-booking-flow/02-01-SUMMARY.md`
</output>
